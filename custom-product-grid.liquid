{%- comment -%}
  Editorial Product Grid - V4 (Centralized, Refined Typography)
  Developer: Senior UX/UI & FE Engineer
{%- endcomment -%}

{%- style -%}
  /* 0. Font Loading */
  @font-face {
    font-family: 'Fraunces';
    src: url('{{ "Fraunces.woff2" | asset_url }}') format('woff2');
    font-weight: 400 700;
    font-display: swap;
  }
  @font-face {
    font-family: 'Inter';
    src: url('{{ "Inter.woff2" | asset_url }}') format('woff2');
    font-weight: 400 500 600;
    font-display: swap;
  }

  /* 1. Scoped CSS Variables */
  #shopify-section-{{ section.id }} {
    --grid-desktop: {{ section.settings.columns_desktop }};
    --grid-tablet: {{ section.settings.columns_tablet }};
    --grid-mobile: {{ section.settings.columns_mobile }};
    --gap: {{ section.settings.grid_gap }}px;
    
    --card-bg: {{ section.settings.card_bg }};
    --text-color: {{ section.settings.text_color }};
    --heading-color: {{ section.settings.heading_color }};
    --price-color: {{ section.settings.price_color }};
    --radius: {{ section.settings.card_radius }}px;
    --aspect-ratio: {{ section.settings.image_ratio }};
    
    --badge-bg: {{ section.settings.badge_bg }};
    --badge-text: {{ section.settings.badge_text }};
    
    --btn-bg: {{ section.settings.btn_bg }};
    --btn-text: {{ section.settings.btn_text_color }};
    
    --font-heading: 'Fraunces', serif;
    --font-body: 'Inter', sans-serif;
  }

  /* 2. Grid Container */
  .eurus-grid {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    max-width: 1400px;
    margin: 0 auto;
    padding-left: 20px;
    padding-right: 20px;
  }

  .eurus-grid__container {
    display: grid;
    grid-template-columns: repeat(var(--grid-mobile), 1fr);
    gap: var(--gap);
  }

  @media (min-width: 768px) {
    .eurus-grid__container {
      grid-template-columns: repeat(var(--grid-tablet), 1fr);
    }
  }

  @media (min-width: 1024px) {
    .eurus-grid__container {
      grid-template-columns: repeat(var(--grid-desktop), 1fr);
    }
  }

  /* 3. Card Base */
  .eurus-card {
    position: relative;
    background-color: var(--card-bg);
    border-radius: var(--radius);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }
  
  .eurus-card.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* 4. Media Area */
  .eurus-card__media {
    position: relative;
    width: 100%;
    aspect-ratio: var(--aspect-ratio);
    overflow: hidden;
    background-color: #f0f0f0;
    display: block; 
  }

  .eurus-card__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease, opacity 0.4s ease;
  }

  .eurus-card:hover .eurus-card__media img {
    transform: scale(1.03);
  }

  /* Secondary Image Swap */
  .eurus-card__img--secondary {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
    z-index: 1;
  }

  {% if section.settings.enable_hover_image %}
  @media (hover: hover) {
    .eurus-card__media:hover .eurus-card__img--secondary {
      opacity: 1;
    }
    .eurus-card__media:hover .eurus-card__img--primary {
      opacity: 0; 
    }
  }
  {% endif %}

  /* 5. BADGES */
  .eurus-card__badges {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 5;
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
  }

  .eurus-badge {
    background-color: var(--badge-bg);
    color: var(--badge-text);
    font-family: var(--font-body);
    font-size: 10px;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.5px;
    padding: 6px 10px;
    border-radius: 4px;
    line-height: 1;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  /* 6. ACTION BUTTONS (Eu Quero) */
  .eurus-btn-desktop {
    display: none;
    position: absolute;
    bottom: 15px;
    left: 15px;
    right: 15px;
    background-color: var(--btn-bg);
    color: var(--btn-text);
    border: none;
    padding: 12px 0;
    border-radius: 30px;
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    z-index: 10;
    text-align: center;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }
  
  .eurus-btn-desktop:hover {
    transform: scale(1.02) translateY(0) !important;
    box-shadow: 0 6px 14px rgba(0,0,0,0.2);
  }

  @media (min-width: 1024px) {
    .eurus-btn-desktop { display: block; }
    .eurus-card:hover .eurus-btn-desktop {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .eurus-btn-mobile {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--btn-bg);
    color: var(--btn-text);
    border: none;
    z-index: 10;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  
  .eurus-btn-mobile svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
  }

  @media (min-width: 1024px) {
    .eurus-btn-mobile { display: none; }
  }

  /* 7. REFINED TYPOGRAPHY & LAYOUT */
  .eurus-card__content {
    padding: 20px 8px; /* Mais respiro vertical */
    display: flex;
    flex-direction: column;
    /* ALINHAMENTO CENTRALIZADO */
    text-align: center; 
    align-items: center; 
    gap: 0; /* Controlado via margin nos filhos */
  }

  .eurus-card__title {
    font-family: var(--font-heading);
    color: var(--heading-color);
    font-weight: 700; 
    font-size: 1.15rem; /* Leve ajuste para proporção ideal */
    line-height: 1.25;
    margin: 0 0 6px 0; /* Espaço reduzido para o preço */
    text-decoration: none;
    
    /* Previne bagunça se o título for longo demais */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .eurus-card__price {
    font-family: var(--font-body);
    color: var(--price-color);
    font-weight: 500;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center; /* Centraliza itens flex */
    gap: 8px;
    margin-bottom: 4px; /* Gruda no parcelamento */
  }

  .eurus-card__price--compare {
    text-decoration: line-through;
    opacity: 0.5;
    font-size: 0.9em;
  }

  .eurus-card__installments {
    font-family: var(--font-body);
    color: var(--text-color);
    
    /* ESTILO EDITORIAL SOLICITADO */
    text-transform: uppercase;
    font-size: 0.7rem; /* Letras pequenas */
    letter-spacing: 0.1em; /* Tracking alto */
    font-weight: 500;
    opacity: 0.75;
    margin-top: 0;
  }

{%- endstyle -%}

<div class="eurus-grid" id="editorial-grid-{{ section.id }}">
  <div class="eurus-grid__container">
    {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
      
      {%- assign loading_attr = 'lazy' -%}
      {%- if forloop.index <= 4 -%}
        {%- assign loading_attr = 'eager' -%}
      {%- endif -%}

      <div class="eurus-card js-reveal-card">
        
        <a href="{{ product.url }}" class="eurus-card__media">
          
          {%- if product.featured_media -%}
            {{ product.featured_media.preview_image | image_url: width: 1000 | image_tag: 
               loading: loading_attr,
               class: 'eurus-card__img--primary',
               widths: '375, 550, 750, 1000'
            }}

            {%- if product.media[1] != nil and section.settings.enable_hover_image -%}
              {{ product.media[1].preview_image | image_url: width: 1000 | image_tag: 
                 loading: 'lazy',
                 class: 'eurus-card__img--secondary',
                 widths: '375, 550, 750, 1000'
              }}
            {%- endif -%}
          {%- else -%}
            {{ 'product-1' | placeholder_svg_tag }}
          {%- endif -%}

          <div class="eurus-card__badges">
            {%- if product.compare_at_price > product.price -%}
              <span class="eurus-badge">Sale</span>
            {%- endif -%}
            {%- for tag in product.tags -%}
              {%- assign tag_lower = tag | downcase -%}
              {%- assign setting_tag_1 = section.settings.custom_tag_1 | downcase -%}
              {%- assign setting_tag_2 = section.settings.custom_tag_2 | downcase -%}
              {%- if tag_lower == setting_tag_1 and section.settings.custom_tag_1 != blank -%}
                <span class="eurus-badge">{{ section.settings.custom_tag_1 }}</span>
              {%- endif -%}
              {%- if tag_lower == setting_tag_2 and section.settings.custom_tag_2 != blank -%}
                <span class="eurus-badge">{{ section.settings.custom_tag_2 }}</span>
              {%- endif -%}
            {%- endfor -%}
          </div>

          <form method="post" action="/cart/add" class="eurus-card__form">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <button type="submit" class="eurus-btn-desktop">{{ section.settings.btn_label }}</button>
            <button type="submit" class="eurus-btn-mobile" aria-label="{{ section.settings.btn_label }}">
               <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            </button>
          </form>

        </a>

        <div class="eurus-card__content">
          <a href="{{ product.url }}" class="eurus-card__title">
            {{ product.title }}
          </a>

          <div class="eurus-card__price">
            <span>{{ product.price | money_without_trailing_zeros }}</span>
            {%- if product.compare_at_price > product.price -%}
              <span class="eurus-card__price--compare">{{ product.compare_at_price | money_without_trailing_zeros }}</span>
            {%- endif -%}
          </div>

          {%- if section.settings.show_installments -%}
            <div class="eurus-card__installments">
              {%- if section.settings.installments_text != blank -%}
                 {%- assign installment_count = 6 -%}
                 {%- assign installment_val = product.price | divided_by: installment_count -%}
                 {%- assign formatted_price = installment_val | money_without_trailing_zeros -%}
                 {{ section.settings.installments_text 
                    | replace: '[price]', formatted_price 
                    | replace: '[count]', installment_count }}
              {%- else -%}
                 6x de {{ product.price | divided_by: 6 | money_without_trailing_zeros }}
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>

      </div>
    {%- else -%}
      <div style="grid-column: 1/-1; padding: 40px; text-align: center; background: #f9f9f9;">
        <p>Adicione produtos à coleção selecionada.</p>
      </div>
    {%- endfor -%}
  </div>
</div>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('#editorial-grid-{{ section.id }} .js-reveal-card').forEach(card => {
      observer.observe(card);
    });
  } else {
    document.querySelectorAll('.js-reveal-card').forEach(c => c.classList.add('is-visible'));
  }
});
</script>

{% schema %}
{
  "name": "Eurus Premium Grid V4",
  "settings": [
    { "type": "collection", "id": "collection", "label": "Coleção" },
    { "type": "range", "id": "products_to_show", "min": 4, "max": 24, "step": 4, "default": 8, "label": "Qtd. Produtos" },
    
    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "columns_desktop", "min": 2, "max": 5, "default": 4, "label": "Colunas PC" },
    { "type": "select", "id": "columns_mobile", "label": "Colunas Mobile", "options": [
      { "value": "1", "label": "1 Coluna" },
      { "value": "2", "label": "2 Colunas" }
    ], "default": "2" },
    { "type": "range", "id": "grid_gap", "min": 0, "max": 40, "default": 20, "label": "Gap (px)" },

    { "type": "header", "content": "Visual do Card" },
    { "type": "select", "id": "image_ratio", "label": "Formato da Foto", "options": [
      { "value": "1/1", "label": "Quadrado" },
      { "value": "4/5", "label": "Retrato (4:5)" },
      { "value": "3/4", "label": "Retrato Alto (3:4)" }
    ], "default": "4/5" },
    { "type": "range", "id": "card_radius", "min": 0, "max": 20, "default": 8, "label": "Arredondamento" },
    { "type": "color", "id": "card_bg", "label": "Fundo Card", "default": "#ffffff" },
    
    { "type": "header", "content": "Cores & Texto" },
    { "type": "color", "id": "heading_color", "label": "Cor Título", "default": "#000000" },
    { "type": "color", "id": "price_color", "label": "Cor Preço", "default": "#1a1a1a" },
    { "type": "color", "id": "text_color", "label": "Cor Parcelamento", "default": "#555555" },

    { "type": "header", "content": "Botão de Compra" },
    { "type": "text", "id": "btn_label", "label": "Texto do Botão", "default": "Eu quero!" },
    { "type": "color", "id": "btn_bg", "label": "Cor Fundo Botão", "default": "#4A5D46" },
    { "type": "color", "id": "btn_text_color", "label": "Cor Texto Botão", "default": "#ffffff" },

    { "type": "header", "content": "Etiquetas (Badges)" },
    { "type": "color", "id": "badge_bg", "label": "Fundo da Etiqueta", "default": "#9F5E33" },
    { "type": "color", "id": "badge_text", "label": "Texto da Etiqueta", "default": "#ffffff" },
    { "type": "text", "id": "custom_tag_1", "label": "Tag Especial 1", "info": "Ex: Digite 'Black Friday'" },
    { "type": "text", "id": "custom_tag_2", "label": "Tag Especial 2", "info": "Ex: 'Best Seller'" },

    { "type": "header", "content": "Extras" },
    { "type": "checkbox", "id": "enable_hover_image", "label": "Trocar foto no hover", "default": true },
    { "type": "checkbox", "id": "show_installments", "label": "Mostrar Parcelamento", "default": true },
    { "type": "text", "id": "installments_text", "label": "Texto Parcelas", "default": "[count]x de [price]" },
    
    { "type": "header", "content": "Espaçamento" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "default": 40, "label": "Topo" },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "default": 40, "label": "Base" }
  ],
  "presets": [{ "name": "Eurus Premium Grid V4" }]
}
{% endschema %}